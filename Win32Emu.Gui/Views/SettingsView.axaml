<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:Win32Emu.Gui.ViewModels"
             x:Class="Win32Emu.Gui.Views.SettingsView"
             x:DataType="vm:SettingsViewModel">
    
    <Grid RowDefinitions="Auto,*">
        <!-- Header -->
        <Border Grid.Row="0" 
                Background="{DynamicResource SystemControlBackgroundAltHighBrush}"
                Padding="20">
            <TextBlock Text="Emulator Settings"
                      FontSize="24"
                      FontWeight="Bold"/>
        </Border>

        <!-- Settings Content -->
        <ScrollViewer Grid.Row="1" Padding="20">
            <StackPanel Spacing="20" MaxWidth="600">
                
                <!-- Rendering Backend -->
                <StackPanel Spacing="8">
                    <TextBlock Text="Rendering Backend"
                             FontWeight="Bold"
                             FontSize="14"/>
                    <ComboBox ItemsSource="{Binding RenderingBackends}"
                            SelectedItem="{Binding RenderingBackend}"
                            HorizontalAlignment="Stretch"/>
                    <TextBlock Text="Select the graphics rendering backend for games"
                             FontSize="12"
                             Opacity="0.7"/>
                </StackPanel>

                <!-- Resolution Scale Factor -->
                <StackPanel Spacing="8">
                    <TextBlock Text="Resolution Scale Factor"
                             FontWeight="Bold"
                             FontSize="14"/>
                    <ComboBox ItemsSource="{Binding ScaleFactors}"
                            SelectedItem="{Binding ResolutionScaleFactor}"
                            HorizontalAlignment="Stretch"/>
                    <TextBlock Text="Upscale the game resolution by this factor (1x = native resolution)"
                             FontSize="12"
                             Opacity="0.7"/>
                </StackPanel>

                <!-- Reserved Memory -->
                <StackPanel Spacing="8">
                    <TextBlock Text="Reserved Memory (MB)"
                             FontWeight="Bold"
                             FontSize="14"/>
                    <NumericUpDown Value="{Binding ReservedMemoryMb}"
                                 Minimum="64"
                                 Maximum="2048"
                                 Increment="64"
                                 HorizontalAlignment="Stretch"/>
                    <TextBlock Text="Amount of memory to allocate for the emulated environment"
                             FontSize="12"
                             Opacity="0.7"/>
                </StackPanel>

                <!-- Windows Version -->
                <StackPanel Spacing="8">
                    <TextBlock Text="Windows Version"
                             FontWeight="Bold"
                             FontSize="14"/>
                    <ComboBox ItemsSource="{Binding WindowsVersions}"
                            SelectedItem="{Binding WindowsVersion}"
                            HorizontalAlignment="Stretch"/>
                    <TextBlock Text="The Windows version to emulate for compatibility"
                             FontSize="12"
                             Opacity="0.7"/>
                </StackPanel>

                <!-- Debug Mode -->
                <StackPanel Spacing="8">
                    <CheckBox IsChecked="{Binding EnableDebugMode}"
                            Content="Enable Debug Mode"/>
                    <TextBlock Text="Enable enhanced debugging to catch memory access errors"
                             FontSize="12"
                             Opacity="0.7"
                             Margin="0,-8,0,0"/>
                </StackPanel>

                <!-- GDB Server Section -->
                <Border BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}"
                        BorderThickness="0,1,0,0"
                        Padding="0,20,0,0"
                        Margin="0,20,0,0">
                    <StackPanel Spacing="20">
                        <TextBlock Text="GDB Server (Ghidra/IDA Integration)"
                                 FontWeight="Bold"
                                 FontSize="16"/>

                        <!-- Enable GDB Server -->
                        <StackPanel Spacing="8">
                            <CheckBox IsChecked="{Binding EnableGdbServer}"
                                    Content="Enable GDB Server"/>
                            <TextBlock Text="Start GDB server for remote debugging with Ghidra, IDA Pro, or GDB"
                                     FontSize="12"
                                     Opacity="0.7"
                                     Margin="0,-8,0,0"/>
                        </StackPanel>

                        <!-- GDB Server Port -->
                        <StackPanel Spacing="8" IsEnabled="{Binding EnableGdbServer}">
                            <TextBlock Text="GDB Server Port"
                                     FontWeight="Bold"
                                     FontSize="14"/>
                            <NumericUpDown Value="{Binding GdbServerPort}"
                                         Minimum="1024"
                                         Maximum="65535"
                                         Increment="1"
                                         HorizontalAlignment="Stretch"/>
                            <TextBlock Text="Port for GDB server to listen on (default: 1234)"
                                     FontSize="12"
                                     Opacity="0.7"/>
                        </StackPanel>

                        <!-- Pause on Start -->
                        <StackPanel Spacing="8" IsEnabled="{Binding EnableGdbServer}">
                            <CheckBox IsChecked="{Binding GdbPauseOnStart}"
                                    Content="Pause on Start"/>
                            <TextBlock Text="Pause emulation at entry point and wait for debugger to connect"
                                     FontSize="12"
                                     Opacity="0.7"
                                     Margin="0,-8,0,0"/>
                        </StackPanel>

                        <!-- Information Panel -->
                        <Border Background="{DynamicResource SystemControlBackgroundAltMediumBrush}"
                                Padding="12"
                                CornerRadius="4"
                                IsVisible="{Binding EnableGdbServer}">
                            <StackPanel Spacing="8">
                                <TextBlock Text="ℹ️ How to Connect"
                                         FontWeight="Bold"
                                         FontSize="13"/>
                                <TextBlock TextWrapping="Wrap"
                                         FontSize="12"
                                         Opacity="0.9">
                                    <Run Text="Once the game starts, the GDB server will be listening on port "/>
                                    <Run Text="{Binding GdbServerPort}" FontWeight="Bold"/>
                                    <Run Text="."/>
                                </TextBlock>
                                <TextBlock TextWrapping="Wrap"
                                         FontSize="12"
                                         Opacity="0.9"
                                         Margin="0,4,0,0">
                                    <Run Text="Connect from Ghidra: "/>
                                    <Run FontFamily="Consolas" Text="Debugger → Connect → gdb → localhost:"/>
                                    <Run FontFamily="Consolas" Text="{Binding GdbServerPort}"/>
                                </TextBlock>
                                <TextBlock TextWrapping="Wrap"
                                         FontSize="12"
                                         Opacity="0.9">
                                    <Run Text="Connect from GDB: "/>
                                    <Run FontFamily="Consolas" Text="target remote localhost:"/>
                                    <Run FontFamily="Consolas" Text="{Binding GdbServerPort}"/>
                                </TextBlock>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </Border>

            </StackPanel>
        </ScrollViewer>
    </Grid>
</UserControl>
