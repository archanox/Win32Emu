<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:Win32Emu.Gui.ViewModels"
             xmlns:models="using:Win32Emu.Gui.Models"
             x:Class="Win32Emu.Gui.Views.GameLibraryView"
             x:DataType="vm:GameLibraryViewModel">
    
    <Grid RowDefinitions="Auto,*">
        <!-- Header with Add Game button -->
        <Border Grid.Row="0" 
                Background="{DynamicResource SystemControlBackgroundAltHighBrush}"
                Padding="20">
            <Grid ColumnDefinitions="*,Auto,Auto">
                <TextBlock Grid.Column="0"
                          Text="Game Library"
                          FontSize="24"
                          FontWeight="Bold"/>
                <Button Grid.Column="1"
                        Content="Add Folder"
                        Command="{Binding AddFolderCommand}"
                        Margin="0,0,10,0"/>
                <Button Grid.Column="2"
                        Content="Add Game"
                        Command="{Binding AddGameCommand}"/>
            </Grid>
        </Border>

        <!-- Game Grid or Empty State -->
        <Grid Grid.Row="1">
            <!-- Empty State Message -->
            <Border IsVisible="{Binding !Games.Count}"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center">
                <StackPanel Spacing="20" HorizontalAlignment="Center">
                    <TextBlock Text="ðŸ“š"
                             FontSize="72"
                             HorizontalAlignment="Center"/>
                    <TextBlock Text="Your library is empty"
                             FontSize="20"
                             FontWeight="Bold"
                             HorizontalAlignment="Center"/>
                    <TextBlock Text="Click 'Add Game' or 'Add Folder' above to get started"
                             FontSize="14"
                             Opacity="0.7"
                             HorizontalAlignment="Center"/>
                </StackPanel>
            </Border>

            <!-- Game Grid -->
            <ScrollViewer Padding="20" IsVisible="{Binding Games.Count}">
                <ItemsControl ItemsSource="{Binding Games}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <WrapPanel Orientation="Horizontal" />
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate DataType="models:Game">
                            <Border Margin="10"
                                    Padding="15"
                                    Background="{DynamicResource SystemControlBackgroundAltMediumBrush}"
                                    CornerRadius="8"
                                    Width="200"
                                    Height="280">
                                <Border.ContextFlyout>
                                    <MenuFlyout>
                                        <MenuItem Header="View Info" 
                                                Command="{Binding $parent[UserControl].((vm:GameLibraryViewModel)DataContext).ShowGameInfoCommand}"
                                                CommandParameter="{Binding}"/>
                                        <MenuItem Header="Launch" 
                                                Command="{Binding $parent[UserControl].((vm:GameLibraryViewModel)DataContext).LaunchGameCommand}"
                                                CommandParameter="{Binding}"/>
                                        <MenuItem Header="Remove" 
                                                Command="{Binding $parent[UserControl].((vm:GameLibraryViewModel)DataContext).RemoveGameCommand}"
                                                CommandParameter="{Binding}"/>
                                    </MenuFlyout>
                                </Border.ContextFlyout>
                                <Grid RowDefinitions="150,Auto,*,Auto">
                                    <!-- Thumbnail placeholder -->
                                    <Border Grid.Row="0"
                                           Background="{DynamicResource SystemControlBackgroundBaseMediumBrush}"
                                           CornerRadius="4">
                                        <TextBlock Text="ðŸŽ®"
                                                 FontSize="64"
                                                 HorizontalAlignment="Center"
                                                 VerticalAlignment="Center"/>
                                    </Border>

                                    <!-- Game Title -->
                                    <TextBlock Grid.Row="1"
                                              Text="{Binding Title}"
                                              FontSize="16"
                                              FontWeight="Bold"
                                              Margin="0,10,0,5"
                                              TextWrapping="Wrap"/>

                                    <!-- Game Info -->
                                    <StackPanel Grid.Row="2" Spacing="4">
                                        <TextBlock Text="{Binding Description}"
                                                 TextWrapping="Wrap"
                                                 FontSize="12"
                                                 Opacity="0.7"/>
                                        <TextBlock Text="{Binding TimesPlayed, StringFormat='Played: {0} times'}"
                                                 FontSize="12"
                                                 Opacity="0.7"/>
                                    </StackPanel>

                                    <!-- Action Buttons -->
                                    <StackPanel Grid.Row="3" 
                                               Orientation="Horizontal" 
                                               Spacing="5"
                                               Margin="0,10,0,0">
                                        <Button Content="Launch"
                                               Command="{Binding $parent[ItemsControl].((vm:GameLibraryViewModel)DataContext).LaunchGameCommand}"
                                               CommandParameter="{Binding}"
                                               HorizontalAlignment="Stretch"/>
                                        <Button Content="Remove"
                                               Command="{Binding $parent[ItemsControl].((vm:GameLibraryViewModel)DataContext).RemoveGameCommand}"
                                               CommandParameter="{Binding}"/>
                                    </StackPanel>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>
        </Grid>
    </Grid>
</UserControl>
